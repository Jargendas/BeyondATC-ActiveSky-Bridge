# BeyondATC <-> ActiveSky Bridge
## Historic and custom weather support for the impatient

[BeyondATC](https://www.beyondatc.net) is a great tool for realistic flight simulation, but only supports live weather at the moment. This project allows to change that, by immitating the live-weather data source, but instead serving the weather data generated by [ActiveSky](https://hifisimtech.com), which can be live, historic or custom.

This method also works for other software using [aviationweather.gov](https://aviationweather.gov) for weather data, e.g. the EFB of the [Fenix A320](https://fenixsim.com) model.

## Prequesites

It is assumed that ActiveSky and BeyondATC are already installed and setup. No configuration steps are necessary in those softwares.

It is also assumed you have a reasonably recent version of python and pip installed and working in the command line terminal.

## Installation

There are a few steps necessary to set the bridge up:

### Step 1: Download project

First, clone or download (and unzip) this repository to a directory of your choice.

### Step 2: Modify hosts file

Next, we need to redirect requests for the live weather source, aviationweather.gov, to the local PC. To achieve this, open the file `C:\Windows\System32\drivers\etc\hosts` with admin privileges, add the following line and save it:

```
127.0.0.1 aviationweather.gov
```

To make sure the changes are effective, flush the DNS cache using the following command in a CMD terminal:
```
ipconfig /flushdns
```

### Step 3.1: Generate certificate

To make BeyondATC think it is still talking to aviationweather.gov, we need to create a https certificate. It would be potentially hazardous to publish it, therefore you have to generate your own, as follows.

Go to [certificatetools.com](https://certificatetools.com) and set the following parameters:
- On top, in `X509v3 Extension Templates`, select `Webserver`.
- Open `Add / Remove Attributes` and deselect everything but `Common Names`.
- In the field `Common Names` below, insert `aviationweather.gov`.
- Under `Subjective Alternative Names`, select `DNS` and also insert `aviationweather.gov`. Click `Add`, insert `*.aviationweather.com` and click `Add` again.
- Under `CSR Options` select `Self-Sign` and insert 10 years validity next to it.
- Click `Submit` on the bottom.

In the appearing section, download the `Private Key` and the `PEM Certificate` from the Download section.

### Step 3.2: Trust the certificate

To be accepted by BeyondATC, the certificate must be installed into the machine as a trusted root certificate.

- Double-click the downloaded ```cert.crt``` file.
- In the window that opens, click `Install Certificate...`, then select `Local Machine` for store location and click `Next`. 
- On the following page, select `Place all certificates in the following store`, click `Browse...` and select `Third-Party Root Certification Authorities`. 
- Click `OK` and `Next`. If everything worked, it should show `The import was successful.`.

### Step 3.3: Copy and rename certificate files

Copy both the `cert.crt` and the `cert.key` files to the downloaded repository folder and rename them to `cert.pem` and `key.pem` respectively.

### Step 4: Install dependencies

Open a command line terminal and navigate to the folder of the downloaded project using the `cd` command. Once there, execute 
```
pip install requirements.txt
``` 
and monitor the installation is successful.

## Usage

Before starting BeyondATC (ActiveSky should already run), start a command line terminal, navigate repository folder, run 
```
python main.py
```
and proceed as normal! BeyondATC and other programs using aviationweather.gov (e.g. Fenix A320) should now instead receive the ActiveSky data. 

ActiveSky's own requests to aviationweather.gov should automatically be forwarded to the actual site, providing the expected response.

## Uninstalling

Just remove or comment the line in the hosts file you added in installation step 2. Everything should work normally afterwards.

## Known Issues

- ActiveSky data loading will be slower. This is due to the proxying of aviationweather.gov, it might work better to use VATSIM or HiFi's data source instead, I haven't tried though.
